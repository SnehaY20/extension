(()=>{pdfjsLib.GlobalWorkerOptions.workerSrc=chrome.runtime.getURL("lib/pdf.worker.min.js");const e=document.getElementById("dropZone"),t=document.getElementById("fileInput"),n=document.getElementById("loading"),a=document.getElementById("error"),r=document.getElementById("previewContainer"),o=document.getElementById("previewImage"),i=document.getElementById("downloadBtn"),s=document.querySelectorAll(".format-option"),c=document.getElementById("quality");let d="png",l=1,v=null,m=null;function g(e){if(e.size>10485760)return void p("File size must be less than 10MB");n.classList.add("active"),a.classList.remove("active"),r.classList.remove("active");const t=new FileReader;t.onload=async function(e){try{const t=new Uint8Array(e.target.result),n=await pdfjsLib.getDocument(t).promise,a=await n.getPage(1),r=a.getViewport({scale:1.5}),o=document.createElement("canvas"),i=o.getContext("2d");o.height=r.height,o.width=r.width,await a.render({canvasContext:i,viewport:r}).promise,m=o,u(),f()}catch(e){console.error("Conversion error:",e),p("Error converting PDF: "+e.message),f()}},t.onerror=function(){console.error("FileReader error",t.error),p("Error reading file"),f()},t.readAsArrayBuffer(e)}function u(){if(!m)return void console.warn("originalCanvas not available for updateImage");const e=document.createElement("canvas"),t=e.getContext("2d");e.width=m.width,e.height=m.height,t.drawImage(m,0,0);let n="png"===d?void 0:l;var a;v=e.toDataURL(`image/${d}`,n),a=v,o.src=a,r.classList.add("active")}function f(){n.classList.remove("active")}function p(e){a.textContent=e,a.classList.add("active"),n.classList.remove("active"),r.classList.remove("active")}e.addEventListener("click",(()=>{t?t.click():console.error("File input element not found!")})),t.addEventListener("change",(function(e){const t=e.target.files[0];t?g(t):console.log("No file selected via input")})),e.addEventListener("dragover",(t=>{t.preventDefault(),e.classList.add("dragover")})),e.addEventListener("dragleave",(()=>{e.classList.remove("dragover")})),e.addEventListener("drop",(t=>{t.preventDefault(),e.classList.remove("dragover");const n=t.dataTransfer.files[0];n&&"application/pdf"===n.type?g(n):p("Please select a valid PDF file")})),s.forEach((e=>{e.addEventListener("click",(()=>{s.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),d=e.dataset.format,u()}))})),c.addEventListener("change",(e=>{l=parseFloat(e.target.value),u()})),i.addEventListener("click",(()=>{if(v){const e=document.createElement("a");e.download=`converted.${d}`,e.href=v,e.click()}else console.warn("No image to download")}))})();